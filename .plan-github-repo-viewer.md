# GitHub Repository Viewer - Architectural Plan

## Feature Goal
Create `/github/[repo]` pages to display GitHub repository information, off-loading the README/landing page aspect from GitHub to ejfox.com.

## Codebase Context

### Existing Patterns
- **GitHub Integration**: Already has `server/api/github.get.ts` using GraphQL API
- **Dynamic Routes**: Uses `pages/[slug].vue` pattern (e.g., `/projects/[slug]`)
- **API Pattern**: `useAsyncData` + server endpoints
- **Display Style**: Minimal, data-dense Tuftian design with mono fonts
- **Components**: `StatSection`, `StatRow`, `AnimatedNumber` for data display
- **Existing GitHub Token**: Already configured via runtime config

### Similar Features
- `/projects/[slug]` - Displays project content from JSON
- `/stats` - Aggregates multiple APIs with caching
- `/gear` - CSV-based data with visualizations

## Architectural Decisions (FINALIZED)

### ‚úÖ Decision 1: Route Structure
**Chosen**: `/github/[repo]` - Your repos only

Clean URLs like `ejfox.com/github/website2`, assumes all repos are yours (ejfox/*).

---

### ‚úÖ Decision 2: Data Source Strategy
**Chosen**: Hybrid - JSON for metadata, API for dynamic stats

README/metadata stored as JSON (fast, no rate limits), live stats fetched via API.

---

### ‚úÖ Decision 3: Content Scope
**Chosen**: Medium - README + stats + recent commits + activity

Includes README, basic stats (stars/forks), recent commits, and activity calendar.

---

### ‚úÖ Decision 4: Repository Selection
**Chosen**: All public repos automatically

Export every public repo, available at `/github/[repo-name]` route.

---

### ‚úÖ Decision 5: README Rendering
**Chosen**: Pre-process during build

Use existing blog markdown pipeline (unified/rehype) for consistent styling.

---

### ‚úÖ Decision 6: Update Frequency
**Chosen**: Auto-update on deploy

Part of build process, runs automatically when you deploy.

---

### ‚úÖ Decision 7: Related Content
**Chosen**: Show related posts only when they exist

If blog posts mention the repo, show them. Otherwise hide the section.

---

### ‚úÖ Decision 8: Visual Design
**Chosen**: Match site's minimal Tuftian style

Zinc colors, mono font, data-dense layout - consistent with existing design.

---

### ‚úÖ Decision 9: API Usage
**Chosen**: GraphQL (already integrated)

Leverage existing `makeGitHubRequest` helper and GraphQL setup.

---

### ‚úÖ Decision 10: File Organization
**Chosen**: `data/github-repos/*.json` - One file per repo

Scalable, matches existing `github-commits.json` pattern.

---

## Implementation Plan (FINALIZED)

### Phase 1: Data Export Script
**File**: `scripts/export-github-repos.mjs`

1. Use existing `makeGitHubRequest` pattern from `server/api/github.get.ts`
2. GraphQL query to fetch all public repos:
   - Repository name, description, URL, homepage
   - Stars, forks, watchers, open issues
   - Primary language, topics/tags
   - README content (base64 encoded)
   - Created/updated timestamps
3. For each repo:
   - Decode and process README markdown with unified/rehype (reuse blog pipeline)
   - Extract first 160 chars for meta description
   - Generate HTML from markdown
4. Write to `data/github-repos/[repo-name].json` with structure:
   ```json
   {
     "name": "website2",
     "description": "Personal website...",
     "url": "https://github.com/ejfox/website2",
     "homepage": "https://ejfox.com",
     "stats": {
       "stars": 5,
       "forks": 1,
       "watchers": 3,
       "openIssues": 2
     },
     "language": "Vue",
     "topics": ["nuxt", "vue3", "tailwind"],
     "readme": {
       "html": "<h1>...",
       "raw": "# Website2\n...",
       "excerpt": "Personal website..."
     },
     "createdAt": "2024-01-01",
     "updatedAt": "2024-12-03"
   }
   ```
5. Generate `data/github-repos-index.json` with list of all repo names
6. Add to `package.json` scripts: `"github:export": "node scripts/export-github-repos.mjs"`

### Phase 2: API Endpoint
**File**: `server/api/repos/[slug].get.ts`

1. Read JSON from `data/github-repos/[slug].json`
2. If not found, return 404 error
3. Optionally fetch live stats via GitHub API (hybrid approach):
   - Use simple REST call: `GET /repos/ejfox/[slug]`
   - Extract current stars/forks/watchers
   - Merge with cached README content
4. Add response caching (5 minutes for live stats)
5. Return combined data structure

**Alternative File**: `server/api/repos/[slug]/commits.get.ts`
- Separate endpoint for recent commits
- Cache for 10 minutes
- Used by page component to show activity

### Phase 3: Page Component
**File**: `pages/github/[slug].vue`

**Layout Structure**:
```vue
<template>
  <div class="container-main">
    <article class="py-8 md:py-16">
      <!-- Header -->
      <header>
        <h1>{{ repo.name }}</h1>
        <p>{{ repo.description }}</p>
        <div class="stats-row">
          <span>‚≠ê {{ repo.stats.stars }}</span>
          <span>üîÄ {{ repo.stats.forks }}</span>
          <span>{{ repo.language }}</span>
        </div>
      </header>

      <!-- README Content -->
      <div v-html="repo.readme.html" />

      <!-- Recent Activity -->
      <section v-if="commits?.length">
        <h2>Recent Commits</h2>
        <CommitCard v-for="commit in commits.slice(0, 5)" />
      </section>

      <!-- Related Posts -->
      <section v-if="relatedPosts?.length">
        <h2>Related Posts</h2>
        <PostCard v-for="post in relatedPosts" />
      </section>
    </article>

    <!-- Sidebar via Teleport -->
    <ClientOnly>
      <Teleport to="#nav-toc-container">
        <div>
          <h3>Repository Info</h3>
          <div>Language: {{ repo.language }}</div>
          <div>Created: {{ formatDate(repo.createdAt) }}</div>
          <a :href="repo.url">View on GitHub ‚Üó</a>
          <a v-if="repo.homepage" :href="repo.homepage">Website ‚Üó</a>
        </div>
      </Teleport>
    </ClientOnly>
  </div>
</template>
```

**Data Fetching**:
```javascript
// Fetch repo metadata from JSON
const { data: repo } = await useAsyncData(
  `repo-${slug}`,
  () => $fetch(`/api/repos/${slug}`)
)

// Fetch live commits (separate API call)
const { data: commits } = await useAsyncData(
  `repo-commits-${slug}`,
  () => $fetch(`/api/repos/${slug}/commits`)
)

// Find related blog posts (search manifest for repo mentions)
const relatedPosts = computed(() => {
  // Query manifest-lite.json for posts containing repo name or URL
})
```

**Styling**:
- Reuse `.container-main` wrapper (65ch max-width)
- Stats in mono font with zinc colors
- CommitCard component (already exists)
- Match project page layout patterns

### Phase 4: Component Updates
**File**: `components/GithubRepoCard.vue` (NEW)

Minimal card for displaying repo in lists:
```vue
<template>
  <article class="repo-card">
    <div class="flex gap-2">
      <div class="flex-shrink-0">
        <span class="text-zinc-400 text-xs">{{ language[0] }}</span>
      </div>
      <div class="flex-grow">
        <h3 class="font-mono text-sm">{{ name }}</h3>
        <p class="text-xs text-zinc-500">{{ description }}</p>
        <div class="stats text-xs">
          <span>‚≠ê {{ stars }}</span>
          <span>üîÄ {{ forks }}</span>
        </div>
      </div>
    </div>
  </article>
</template>
```

### Phase 5: Integration & Deployment
1. **Add to package.json**:
   ```json
   {
     "scripts": {
       "github:export": "node scripts/export-github-repos.mjs",
       "build": "yarn github:export && nuxt build"
     }
   }
   ```

2. **Update `.github/workflows/deploy.yml`**:
   - Ensure `yarn github:export` runs before build
   - May already be covered by `yarn build`

3. **Add to sitemap** (`pages/sitemap.vue`):
   - Read `github-repos-index.json`
   - Generate links for all repos

4. **Add index page** (`pages/github/index.vue`):
   - List all repos with GithubRepoCard
   - Search/filter by language or topic
   - Sort by stars, updated date, etc.

5. **Link from relevant places**:
   - Projects page (if repo has GitHub link)
   - Stats page (GitHub section)
   - Footer (GitHub profile link)

### Phase 6: Nice-to-Haves (Future)
- Activity calendar showing commit frequency
- Contributor list with avatars
- Language breakdown chart
- Dependencies visualization (from package.json)
- GitHub Actions badge/status
- Clone/download buttons
- Star history sparkline

## Technical Implementation Notes

### Reusable Code
- `makeGitHubRequest` helper from `server/api/github.get.ts`
- Markdown processing from `scripts/processMarkdown.mjs`
- CommitCard component from on-this-day feature
- StatSection/StatRow from stats page
- TOC teleport pattern from projects page

### New Dependencies
- None! Everything uses existing packages

### Error Handling
- 404 for missing repos (like `pages/projects/[slug].vue`)
- Rate limit handling (already in GitHub API helper)
- Fallback for missing README (show metadata only)
- Client-side error boundaries

### Performance
- Pre-processed README (fast HTML delivery)
- Optional live stats (cached 5 min)
- Lazy load commits section
- Image optimization via Cloudinary (if README has images)

### SEO
- Dynamic meta tags (title, description, OG image)
- Canonical URL to ejfox.com/github/[repo]
- Structured data (SoftwareSourceCode schema)
- Sitemap integration

## Files to Create/Modify

### New Files
- `scripts/export-github-repos.mjs` - Export script
- `server/api/repos/[slug].get.ts` - API endpoint
- `server/api/repos/[slug]/commits.get.ts` - Commits endpoint
- `pages/github/[slug].vue` - Repo page
- `pages/github/index.vue` - Repo listing
- `components/GithubRepoCard.vue` - Card component
- `data/github-repos/*.json` - Generated data
- `data/github-repos-index.json` - Repo list

### Modified Files
- `package.json` - Add github:export script
- `pages/sitemap.vue` - Include GitHub repos
- `.github/workflows/deploy.yml` - Ensure export runs
- `pages/projects/[slug].vue` - Link to GitHub page if available

### Existing Files to Reference
- `server/api/github.get.ts` - GraphQL patterns
- `scripts/processMarkdown.mjs` - Markdown processing
- `pages/projects/[slug].vue` - Page layout patterns
- `components/CommitCard.vue` - Commit display
